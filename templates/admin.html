<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oasis-Nav 管理后台</title>
    <link rel="stylesheet" href="/static/css/common.css?v=13">
    <link rel="stylesheet" href="/static/css/admin.css?v=13">
</head>
<body>
    <div class="container">
        <!-- 初始化面板 -->
        <div class="init-panel hidden" id="initPanel">
            <h2>🚀 初始化 Oasis-Nav</h2>
            <p style="text-align:center; color:var(--text-muted); margin-bottom:25px;">首次使用，请设置管理密码</p>
            <div class="form-group">
                <label>管理密码</label>
                <input type="password" id="initPassword" placeholder="至少8位，需包含字母和数字">
            </div>
            <div class="form-group">
                <label>确认密码</label>
                <input type="password" id="initPasswordConfirm" placeholder="再次输入">
            </div>
            <button class="btn btn-primary" style="width:100%" onclick="initPassword(event)">初始化</button>
            <div class="error-msg" id="initError"></div>
        </div>

        <!-- 登录面板 -->
        <div class="login-panel hidden" id="loginPanel">
            <h2>🔐 Oasis-Nav 管理后台</h2>
            <div class="form-group">
                <label>用户名</label>
                <input type="text" id="loginUsername" placeholder="请输入用户名" onkeydown="if(event.key==='Enter')document.getElementById('loginPassword').focus()">
            </div>
            <div class="form-group">
                <label>密码</label>
                <input type="password" id="loginPassword" placeholder="请输入密码" onkeydown="if(event.key==='Enter')login()">
            </div>
            <button class="btn btn-primary" style="width:100%" onclick="login()">登录</button>
            <div class="error-msg" id="loginError"></div>
        </div>

        <!-- 管理面板 -->
        <div class="admin-panel hidden" id="adminPanel">
            <div class="header">
                <h1>
                    <a href="/">← Oasis-Nav</a>
                    <span style="color:var(--text-muted)">管理后台</span>
                </h1>
                <div style="display:flex;align-items:center;gap:15px;">
                    <div class="theme-switcher">
                        <div class="theme-dot active" data-theme="warm" title="米黄护眼"></div>
                        <div class="theme-dot" data-theme="light" title="明亮"></div>
                        <div class="theme-dot" data-theme="dark" title="深暗"></div>
                        <div class="theme-dot" data-theme="green" title="绿色护眼"></div>
                    </div>
                    <button class="btn btn-outline" onclick="logout()">退出登录</button>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('links')">链接管理</div>
                <div class="tab" onclick="switchTab('categories')">分类管理</div>
                <div class="tab" onclick="switchTab('settings')">设置</div>
            </div>

            <!-- 链接管理 -->
            <div class="tab-content" id="tab-links">
                <div class="card">
                    <div class="card-header">
                        <h3>链接列表</h3>
                        <button class="btn btn-primary btn-sm" onclick="showLinkModal()">+ 添加链接</button>
                    </div>
                    <p style="font-size:0.8rem;color:var(--text-muted);margin-bottom:15px;">💡 拖拽行可调整顺序（同分类内排序）</p>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:30px;"></th>
                                    <th>标题</th>
                                    <th>URL</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="linksTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 分类管理 -->
            <div class="tab-content hidden" id="tab-categories">
                <div class="card">
                    <div class="card-header">
                        <h3>分类列表</h3>
                        <button class="btn btn-primary btn-sm" onclick="showCategoryModal()">+ 添加分类</button>
                    </div>
                    <p style="font-size:0.8rem;color:var(--text-muted);margin-bottom:15px;">💡 拖拽行可调整顺序</p>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:30px;"></th>
                                    <th>名称</th>
                                    <th>父分类</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 设置 -->
            <div class="tab-content hidden" id="tab-settings">
                <!-- 站点设置 -->
                <div class="card">
                    <h3 style="margin-bottom:20px">🎨 站点设置</h3>
                    <div class="form-group">
                        <label>网站图标 (Favicon URL)</label>
                        <input type="text" id="siteFavicon" placeholder="https://example.com/favicon.ico">
                        <p style="font-size:0.75rem;color:var(--text-muted);margin-top:5px;">留空使用默认图标，建议使用 .ico 或 .png 格式</p>
                    </div>
                    <div class="form-group">
                        <label>左上角图标 (Emoji 或文字)</label>
                        <input type="text" id="siteIcon" placeholder="🥭" maxlength="10">
                    </div>
                    <div class="form-group">
                        <label>网站标题</label>
                        <input type="text" id="siteTitle" placeholder="Nav">
                    </div>
                    <div class="form-group">
                        <label>页脚自定义</label>
                        <input type="text" id="footerText" placeholder="例如：我的个人导航 或 <a href='链接'>文字</a>">
                        <p style="font-size:0.75rem;color:var(--text-muted);margin-top:5px;">支持 HTML，如 &lt;a href="链接"&gt;文字&lt;/a&gt;</p>
                    </div>
                    <button class="btn btn-primary" onclick="updateSiteSettings()">保存站点设置</button>
                    <div class="success-msg hidden" id="siteSettingsSuccess">保存成功</div>
                    <div class="error-msg" id="siteSettingsError"></div>
                </div>

                <!-- 管理账号设置 -->
                <div class="card" style="margin-top:20px;">
                    <h3 style="margin-bottom:20px">👤 管理账号设置</h3>
                    <div class="form-group">
                        <label>用户名</label>
                        <input type="text" id="adminUsername" placeholder="至少3个字符" maxlength="32">
                    </div>
                    <div class="form-group">
                        <label>新密码（留空则不修改）</label>
                        <input type="password" id="adminNewPassword" placeholder="至少8位，需包含字母和数字">
                    </div>
                    <button class="btn btn-primary" onclick="updateAdminAccount()">保存账号设置</button>
                    <div class="success-msg hidden" id="accountSuccess">更新成功</div>
                    <div class="error-msg" id="accountError"></div>
                </div>

                <!-- 隐藏密码设置 -->
                <div class="card" style="margin-top:20px;">
                    <h3 style="margin-bottom:20px">🔐 隐藏密码设置</h3>
                    <p style="color:var(--text-muted);margin-bottom:20px;font-size:0.9rem;">
                        隐藏密码用于在首页显示隐藏链接，可以和管理密码不同
                    </p>
                    <div class="form-group">
                        <label>新隐藏密码</label>
                        <input type="password" id="newHiddenPassword" placeholder="至少4位">
                    </div>
                    <button class="btn btn-primary" onclick="updateHiddenPassword()">更新隐藏密码</button>
                    <div class="success-msg hidden" id="settingsSuccess">更新成功</div>
                    <div class="error-msg" id="settingsError"></div>
                </div>

                <!-- 书签密码设置 -->
                <div class="card" style="margin-top:20px;">
                    <h3 style="margin-bottom:20px">🔖 书签密码设置</h3>
                    <p style="color:var(--text-muted);margin-bottom:20px;font-size:0.9rem;">
                        书签密码用于访问私密书签页（首页三击调色板打开）
                    </p>
                    <div class="form-group">
                        <label>书签密码</label>
                        <input type="password" id="newBookmarkPassword" placeholder="至少8位，需包含字母和数字">
                    </div>
                    <button class="btn btn-primary" onclick="updateBookmarkPassword()">更新书签密码</button>
                    <div class="success-msg hidden" id="bookmarkSuccess">更新成功</div>
                    <div class="error-msg" id="bookmarkError"></div>
                </div>

                <!-- 后台路径设置 -->
                <div class="card" style="margin-top:20px;">
                    <h3 style="margin-bottom:20px">🔗 后台路径设置</h3>
                    <p style="color:var(--text-muted);margin-bottom:20px;font-size:0.9rem;">
                        自定义后台访问路径，增加安全性。修改后将自动跳转到新路径。
                    </p>
                    <div class="form-group">
                        <label>后台路径</label>
                        <input type="text" id="adminPath" placeholder="/admin">
                        <p style="font-size:0.75rem;color:var(--text-muted);margin-top:5px;">
                            必须以 / 开头，例如：/admin、/manage、/x8k2m9
                        </p>
                    </div>
                    <button class="btn btn-primary" onclick="updateAdminPath()">保存后台路径</button>
                    <div class="success-msg hidden" id="adminPathSuccess">保存成功，即将跳转...</div>
                    <div class="error-msg" id="adminPathError"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 链接编辑弹窗 -->
    <div class="modal-overlay" id="linkModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="linkModalTitle">添加链接</h3>
                <button class="modal-close" onclick="closeLinkModal()">&times;</button>
            </div>
            <input type="hidden" id="linkId">
            <div class="form-group">
                <label>标题 *</label>
                <input type="text" id="linkTitle" placeholder="例如：Google">
            </div>
            <div class="form-group">
                <label>URL *</label>
                <input type="url" id="linkUrl" placeholder="https://example.com">
            </div>
            <div class="form-group">
                <label>图标 URL（留空自动获取）</label>
                <input type="url" id="linkIcon" placeholder="https://example.com/favicon.ico">
            </div>
            <div class="form-group">
                <label>描述</label>
                <textarea id="linkDescription" placeholder="简短描述"></textarea>
            </div>
            <div class="form-group">
                <label>分类</label>
                <select id="linkCategory"></select>
            </div>
            <div class="form-group">
                <label>排序（数字越小越靠前）</label>
                <input type="number" id="linkSort" value="0">
            </div>
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="linkHidden">
                    <label for="linkHidden" style="margin:0;cursor:pointer">设为隐藏链接</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeLinkModal()">取消</button>
                <button class="btn btn-primary" onclick="saveLink()">保存</button>
            </div>
            <div class="error-msg" id="linkError"></div>
        </div>
    </div>

    <!-- 分类编辑弹窗 -->
    <div class="modal-overlay" id="categoryModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="categoryModalTitle">添加分类</h3>
                <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
            </div>
            <input type="hidden" id="categoryId">
            <div class="form-group">
                <label>名称 *</label>
                <input type="text" id="categoryName" placeholder="例如：常用工具">
            </div>
            <div class="form-group">
                <label>父分类（可选）</label>
                <select id="categoryParent"></select>
            </div>
            <div class="form-group">
                <label>排序（数字越小越靠前）</label>
                <input type="number" id="categorySort" value="0">
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeCategoryModal()">取消</button>
                <button class="btn btn-primary" onclick="saveCategory()">保存</button>
            </div>
            <div class="error-msg" id="categoryError"></div>
        </div>
    </div>

    <script src="/static/js/admin.js?v=9"></script>
</body>
</html>
