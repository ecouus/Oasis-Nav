services:
  nav:
    # 生产环境：使用远程镜像（推荐）
    image: ecouus/oasis-nav:latest
    # 开发环境：本地构建（注释上面 image，取消下面注释）
    # build: .
    container_name: oasis-nav
    restart: unless-stopped
    command: ["gunicorn", "-w", "1", "-b", "0.0.0.0:6966", "--timeout", "120", "app:app"]
    ports:
      - "6966:6966"
    volumes:
      # 数据库文件挂载到本地，方便备份和迁移
      # 需要设置权限: mkdir -p ./data && sudo chown -R 999:999 ./data
      - ./data:/app/data
      # 图标缓存目录挂载（可选，持久化图标缓存）
      # 需要设置权限: mkdir -p ./icon_cache && sudo chown -R 999:999 ./icon_cache
      - ./icon_cache:/app/icon_cache
    environment:
      - DATABASE_PATH=/app/data/data.db
      - ICON_CACHE_DIR=/app/icon_cache
      - TZ=Asia/Shanghai
    # 安全设置
    security_opt:
      - no-new-privileges:true
    # 资源限制（可选）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '0.5'
    #       memory: 256M

